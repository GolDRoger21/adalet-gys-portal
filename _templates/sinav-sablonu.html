/**
 * @file Adalet GYS Portalı için ortak şablon yükleyici.
 * @description Header, footer ve modallar gibi ortak HTML bileşenlerini ilgili sayfalara dinamik olarak yükler.
 * @version 6.0 (Robust Container-Based Loading)
 */

document.addEventListener('DOMContentLoaded', () => {
    // Şablonun yükleneceği ana konteyneri bul
    const container = document.getElementById('template-container');
    
    // Eğer sayfada bu konteyner varsa, yükleyiciyi çalıştır
    if (container) {
        loadCommonTemplate(container);
    }
});

/**
 * Şablonu sunucudan çeker ve içeriğini belirlenen konteynerin içine enjekte eder.
 * @param {HTMLElement} container - Şablon içeriğinin ekleneceği HTML elementi.
 */
async function loadCommonTemplate(container) {
    try {
        const response = await fetch('/adalet-gys-portal/_templates/sinav-sablonu.html');
        if (!response.ok) {
            throw new Error(`Şablon dosyası (/.../_templates/sinav-sablonu.html) yüklenemedi.`);
        }
        const templateText = await response.text();
        
        // Şablonun tüm içeriğini doğrudan konteynerin içine yaz
        container.innerHTML = templateText;
        
        // Sınavla ilgili olan ve tam ekran olması gereken pencereleri (modalları),
        // ana body etiketine taşı. Bu, sadece sınav sayfalarında gerekli olacak.
        if (document.getElementById('app-container')) { // app-container sadece sınav sayfalarında var
            const resultModal = container.querySelector('#result-modal');
            const alertModal = container.querySelector('#alert-modal');
            
            if (resultModal) document.body.appendChild(resultModal);
            if (alertModal) document.body.appendChild(alertModal);
        }

        // Her şeyin bittiğini ve diğer script'lerin başlayabileceğini bildiren sinyali gönder.
        document.dispatchEvent(new Event('template-loaded'));

    } catch (error) {
        console.error('Şablon yükleme hatası:', error);
        container.innerHTML = '<div class="card p-8 text-center"><h1 class="text-xl font-bold text-red-600">Tema yüklenirken bir hata oluştu.</h1></div>';
    }
}
